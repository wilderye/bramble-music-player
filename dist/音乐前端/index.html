<head><script type="module">import{identity as e,isClient as t,isObject as l,toArray as o,tryOnScopeDispose as n,watchImmediate as a}from'https://testingcf.jsdelivr.net/npm/@vueuse/shared/+esm';var r={502(e,t){t.A=(e,t)=>{const l=e.__vccOpts||e;for(const[e,o]of t)l[e]=o;return l}}},i={};const s=Vue;const c=t?window:void 0;t&&window.document,t&&window.navigator,t&&window.location;function u(e){var t;const l=(0,s.toValue)(e);return null!=(t=null==l?void 0:l.$el)?t:l}function d(...e){const t=[],r=()=>{t.forEach(e=>e()),t.length=0},i=(0,s.computed)(()=>{const t=o((0,s.toValue)(e[0])).filter(e=>null!=e);return t.every(e=>'string'!=typeof e)?t:void 0}),d=a(()=>{var t,l;return[null!=(l=null==(t=i.value)?void 0:t.map(e=>u(e)))?l:[c].filter(e=>null!=e),o((0,s.toValue)(i.value?e[1]:e[0])),o((0,s.unref)(i.value?e[2]:e[1])),(0,s.toValue)(i.value?e[3]:e[2])]},([e,o,n,a])=>{if(r(),!(null==e?void 0:e.length)||!(null==o?void 0:o.length)||!(null==n?void 0:n.length))return;const i=l(a)?{...a}:a;t.push(...e.flatMap(e=>o.flatMap(t=>n.map(l=>((e,t,l,o)=>(e.addEventListener(t,l,o),()=>e.removeEventListener(t,l,o)))(e,t,l,i)))))},{flush:'post'});return n(r),()=>{d(),r()}}function v(e,t,l){var o,n;const a=(0,s.computed)(()=>u(e));let r,i,c,v=!1;function m(){r&&(clearTimeout(r),r=void 0),i=void 0,c=void 0,v=!1}const p={capture:null==(o=null==l?void 0:l.modifiers)?void 0:o.capture,once:null==(n=null==l?void 0:l.modifiers)?void 0:n.once},f=[d(a,'pointerdown',function(e){var o,n,s;(null==(o=null==l?void 0:l.modifiers)?void 0:o.self)&&e.target!==a.value||(m(),(null==(n=null==l?void 0:l.modifiers)?void 0:n.prevent)&&e.preventDefault(),(null==(s=null==l?void 0:l.modifiers)?void 0:s.stop)&&e.stopPropagation(),i={x:e.x,y:e.y},c=e.timeStamp,r=setTimeout(()=>{v=!0,t(e)},function(e){const t=null==l?void 0:l.delay;return'function'==typeof t?t(e):null!=t?t:500}(e)))},p),d(a,'pointermove',function(e){var t,o,n,r;if((null==(t=null==l?void 0:l.modifiers)?void 0:t.self)&&e.target!==a.value)return;if(!i||!1===(null==l?void 0:l.distanceThreshold))return;(null==(o=null==l?void 0:l.modifiers)?void 0:o.prevent)&&e.preventDefault(),(null==(n=null==l?void 0:l.modifiers)?void 0:n.stop)&&e.stopPropagation();const s=e.x-i.x,c=e.y-i.y;Math.sqrt(s*s+c*c)>=(null!=(r=null==l?void 0:l.distanceThreshold)?r:10)&&m()},p),d(a,['pointerup','pointerleave'],function(e){var t,o,n;const[r,s,u]=[c,i,v];if(m(),!(null==l?void 0:l.onMouseUp)||!s||!r)return;if((null==(t=null==l?void 0:l.modifiers)?void 0:t.self)&&e.target!==a.value)return;(null==(o=null==l?void 0:l.modifiers)?void 0:o.prevent)&&e.preventDefault(),(null==(n=null==l?void 0:l.modifiers)?void 0:n.stop)&&e.stopPropagation();const d=e.x-s.x,p=e.y-s.y,f=Math.sqrt(d*d+p*p);l.onMouseUp(e.timeStamp-r,f,u)},p)];return()=>f.forEach(e=>e())}Symbol('vueuse-ssr-width');'undefined'!=typeof globalThis?globalThis:'undefined'!=typeof window?window:'undefined'!=typeof globalThis?globalThis:'undefined'!=typeof self&&self;Number.POSITIVE_INFINITY;const m={class:'player-root'},p={class:'player-content-wrapper'},f={key:0,class:'player-main'},y={class:'track-info'},V=['src'],E={key:1,class:'cover-art cover-art-placeholder'},N={class:'details'},g=['title'],k=['title'],h={class:'controls'},w={class:'main-controls'},C=['title'],b={class:'volume-control-wrapper'},I={class:'playlist-drawer'},P={class:'playlist'},x=['title','onClick'],B={class:'index'},M={class:'title'},S={class:'artist'},D={class:'track'},T={key:1,class:'error-overlay'},A=(0,s.defineComponent)({__name:'app',setup(e){const t=(0,s.ref)(!1),l=(0,s.ref)(!1),o=(0,s.ref)(null),n=(0,s.ref)(null),a=(0,s.ref)(!1),r=e=>console.log(`[播放器前端] ${e}`),i=(0,s.ref)(null);let c=null;const u=(0,s.ref)(null),d=(0,s.ref)(!1),A=(0,s.ref)(!1),L=(0,s.ref)(!1),O=(0,s.ref)(null),F=(0,s.ref)([]),U=(0,s.ref)(.5),j=(0,s.ref)(-1),q=(0,s.ref)('list'),R=()=>{if(a.value)return a.value=!1,void r('“轻点”事件被抑制，因为它是一次长按的结束。');const e=['list','random','single'],t=e.indexOf(q.value),l=e[(t+1)%e.length];i.value?.setPlaybackMode(l)};v(n,()=>{t.value=!t.value,t.value&&(l.value=!1),r('长按触发：切换播放列表显示。'),a.value=!0,r('长按已处理，设置“轻点”抑制信号旗。')},{delay:400});const Y=()=>{l.value=!l.value,l.value&&(t.value=!1)},G=()=>{l.value&&(l.value=!1)},H=e=>{r('接收到完整状态更新'),A.value=e.isPlaying,L.value=e.isTransitioning,O.value=e.currentItem,F.value=e.playlist,U.value=e.masterVolume,q.value=e.playbackMode,e.currentItem?j.value=e.playlist.length>0?e.playlist.findIndex(t=>t.title===e.currentItem.title&&t.artist===e.currentItem.artist&&t.cover===e.currentItem.cover):-1:j.value=-1},J=()=>i.value?.togglePlayPause(),K=()=>i.value?.playNext(),Q=()=>i.value?.playPrev(),W=e=>{if(!o.value)return;const t=o.value.getBoundingClientRect(),l=t.bottom-e.clientY,n=Math.max(0,Math.min(1,l/t.height));U.value=n,i.value?.setLiveVolume(n)},X=e=>{W(e)},Z=()=>{document.removeEventListener('mousemove',X),document.removeEventListener('mouseup',Z),i.value?.persistVolumeAndBroadcast(U.value)},ee=e=>{W(e),document.addEventListener('mousemove',X),document.addEventListener('mouseup',Z,{once:!0})};return(0,s.onUnmounted)(()=>{c&&(c(),console.log('[播放器前端] 已注销状态监听器，防止内存泄漏。'))}),(0,s.onMounted)(()=>{console.log('播放器前端已挂载。检查 onLongPress:',v),(async()=>{try{r('开始初始化流程... 界面当前为透明状态。');const l=await(e='musicPlayerAPI',t=1e4,new Promise((l,o)=>{const n=Date.now(),a=setInterval(()=>{'object'==typeof top[e]&&null!==top[e]?(clearInterval(a),l(top[e])):Date.now()-n>t&&(clearInterval(a),o(new Error('连接后台脚本失败。请确认角色卡的脚本开关已打开。若已打开请刷新页面重试。')))},100)}));r('后台脚本API "musicPlayerAPI" 已就绪。'),await Promise.race([l.requestInitialization(),new Promise((_,e)=>setTimeout(()=>e(new Error('后台脚本初始化超时。如果这是您第一次加载角色卡，请尝试刷新页面。')),1e4))]),r('后台初始化请求已成功完成。'),i.value=l;const o=l.getCurrentState();H(o),c=l.onFullStateUpdate(H),r('初始化成功！界面已与后台同步。'),r('[幕启] 后台状态已同步，即将显示界面。'),d.value=!0}catch(e){r(`初始化流程失败: ${e}`),u.value=e instanceof Error?e.message:String(e),d.value=!0}var e,t})()}),(e,a)=>((0,s.openBlock)(),(0,s.createElementBlock)(s.Fragment,null,[(0,s.createCommentVNode)(' [修改点] V9.1 - 新增根节点，用于解耦音量条与主容器的布局 '),(0,s.createElementVNode)('div',m,[(0,s.createElementVNode)('div',{class:(0,s.normalizeClass)(['aria-pod-container',{'is-ready':d.value,'is-playlist-open':t.value,'is-transitioning':L.value}]),onClick:G},[(0,s.createElementVNode)('div',p,[(0,s.createCommentVNode)(' "Aria Pod" 主界面 '),u.value?(0,s.createCommentVNode)('v-if',!0):((0,s.openBlock)(),(0,s.createElementBlock)('div',f,[(0,s.createCommentVNode)(' 1. 当前曲目区 (Track Info) '),(0,s.createElementVNode)('div',y,[O.value?.cover?((0,s.openBlock)(),(0,s.createElementBlock)('img',{key:0,src:O.value.cover,alt:'封面',class:'cover-art'},null,8,V)):((0,s.openBlock)(),(0,s.createElementBlock)('div',E,[...a[1]||(a[1]=[(0,s.createElementVNode)('i',{class:'fa-solid fa-music'},null,-1)])])),(0,s.createElementVNode)('div',N,[(0,s.createCommentVNode)(' 修改点 1：如果没有歌名，显示 \'END\' '),(0,s.createElementVNode)('p',{class:'title',title:O.value?.title},(0,s.toDisplayString)(O.value?.title||'END'),9,g),(0,s.createCommentVNode)(' 修改点 2：如果没有歌手，显示空字符串（即什么都不显示） '),(0,s.createElementVNode)('p',{class:'artist',title:O.value?.artist},(0,s.toDisplayString)(O.value?.artist||''),9,k)])]),(0,s.createCommentVNode)(' 2. 核心控制区 (Playback Controls) '),(0,s.createElementVNode)('div',h,[(0,s.createElementVNode)('button',{ref_key:'modeButtonRef',ref:n,class:'control-btn',title:'切换播放模式 (轻点) / 打开列表 (长按)',onClick:(0,s.withModifiers)(R,['prevent'])},[(0,s.createElementVNode)('i',{class:(0,s.normalizeClass)(['fa-solid',{'fa-list-ul':'list'===q.value,'fa-shuffle':'random'===q.value,'fa-repeat':'single'===q.value}])},null,2)],512),(0,s.createElementVNode)('div',w,[(0,s.createElementVNode)('button',{class:'control-btn',title:'上一首',onClick:Q},[...a[2]||(a[2]=[(0,s.createElementVNode)('i',{class:'fa-solid fa-backward-step'},null,-1)])]),(0,s.createElementVNode)('button',{class:'control-btn play-pause-btn',title:A.value?'暂停':'播放',onClick:J},[(0,s.createElementVNode)('i',{class:(0,s.normalizeClass)(A.value?'fa-solid fa-pause':'fa-solid fa-play')},null,2)],8,C),(0,s.createElementVNode)('button',{class:'control-btn',title:'下一首',onClick:K},[...a[3]||(a[3]=[(0,s.createElementVNode)('i',{class:'fa-solid fa-forward-step'},null,-1)])])]),(0,s.createElementVNode)('div',b,[(0,s.createElementVNode)('button',{class:'control-btn volume-btn',title:'音量',onClick:(0,s.withModifiers)(Y,['stop'])},[...a[4]||(a[4]=[(0,s.createElementVNode)('i',{class:'fa-solid fa-volume-high'},null,-1)])])])])])),(0,s.createCommentVNode)(' 3. 播放列表抽屉 (Playlist Drawer) '),(0,s.createElementVNode)('div',I,[(0,s.createElementVNode)('ul',P,[((0,s.openBlock)(!0),(0,s.createElementBlock)(s.Fragment,null,(0,s.renderList)(F.value,(e,t)=>((0,s.openBlock)(),(0,s.createElementBlock)('li',{key:`${e.title}-${t}`,class:(0,s.normalizeClass)({active:t===j.value}),title:`播放: ${e.title}`,onClick:e=>(e=>i.value?.playIndex(e))(t)},[(0,s.createElementVNode)('span',B,(0,s.toDisplayString)(t+1),1),(0,s.createElementVNode)('span',M,(0,s.toDisplayString)(e.title),1),(0,s.createElementVNode)('span',S,(0,s.toDisplayString)(e.artist),1)],10,x))),128))])])])],2),(0,s.createCommentVNode)(' [修改点] V9.1 - 音量滑块现在是根节点的子元素，与主容器是兄弟关系 '),l.value?((0,s.openBlock)(),(0,s.createElementBlock)('div',{key:0,class:'volume-slider-container',onClick:a[0]||(a[0]=(0,s.withModifiers)(()=>{},['stop']))},[(0,s.createElementVNode)('div',{ref_key:'volumeTrackRef',ref:o,class:'custom-volume-slider',onMousedown:(0,s.withModifiers)(ee,['prevent','stop'])},[(0,s.createElementVNode)('div',D,[(0,s.createElementVNode)('div',{class:'progress',style:(0,s.normalizeStyle)({height:100*U.value+'%'})},null,4)]),(0,s.createElementVNode)('div',{class:'thumb',style:(0,s.normalizeStyle)({bottom:`calc(${100*U.value}% - 4px)`})},null,4)],544)])):(0,s.createCommentVNode)('v-if',!0),(0,s.createCommentVNode)(' 初始化错误提示 (无变化) '),u.value?((0,s.openBlock)(),(0,s.createElementBlock)('div',T,[a[5]||(a[5]=(0,s.createElementVNode)('p',null,[(0,s.createElementVNode)('i',{class:'fa-solid fa-triangle-exclamation'}),(0,s.createTextVNode)(' 播放器加载失败')],-1)),(0,s.createElementVNode)('small',null,(0,s.toDisplayString)(u.value),1)])):(0,s.createCommentVNode)('v-if',!0)])],2112))}});var L=function e(t){var l=i[t];if(void 0!==l)return l.exports;var o=i[t]={exports:{}};return r[t](o,o.exports,e),o.exports}(502);const O=(0,L.A)(A,[['__scopeId','data-v-048593fc']]);$(()=>{(0,s.createApp)(O).mount('#app')});
//# sourceMappingURL=index.js.map</script><style>.player-root[data-v-048593fc]{position:relative;width:100%;max-width:300px;margin-left:auto;margin-right:auto}.aria-pod-container[data-v-048593fc]{font-family:-apple-system,BlinkMacSystemFont,'Segoe UI',Roboto,Helvetica,Arial,sans-serif;color:#f2f2f7;width:100%;transition:height 0.35s cubic-bezier(0.4,0,0.2,1),opacity 0.25s ease-in-out;height:120px;box-sizing:border-box;opacity:0;pointer-events:none;position:relative;will-change:height}.aria-pod-container.is-ready[data-v-048593fc]{opacity:1;pointer-events:auto}.aria-pod-container.is-playlist-open[data-v-048593fc]{height:240px}.aria-pod-container.is-transitioning[data-v-048593fc]{opacity:0.7;pointer-events:none}.player-content-wrapper[data-v-048593fc]{background-color:#1c1c1e;border-radius:12px;box-shadow:0 8px 24px rgba(0,0,0,0.5);padding:12px;width:100%;height:100%;box-sizing:border-box;display:flex;flex-direction:column;overflow:hidden;position:relative;z-index:1}.player-main[data-v-048593fc]{display:flex;flex-direction:column;gap:8px;flex-shrink:0}.track-info[data-v-048593fc]{display:flex;align-items:center;gap:12px;height:52px}.cover-art[data-v-048593fc]{width:52px;height:52px;border-radius:8px;object-fit:cover;flex-shrink:0}.cover-art-placeholder[data-v-048593fc]{display:flex;justify-content:center;align-items:center;background-color:#161618;font-size:22px;color:#8e8e93}.details[data-v-048593fc]{overflow:hidden;display:flex;flex-direction:column;justify-content:center}.details p[data-v-048593fc]{margin:0;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}.title[data-v-048593fc]{font-weight:600;font-size:16px;color:#ffffff}.artist[data-v-048593fc]{font-size:13px;color:#8e8e93}.controls[data-v-048593fc]{display:flex;justify-content:space-between;align-items:center}.main-controls[data-v-048593fc]{display:flex;align-items:center;gap:16px}.control-btn[data-v-048593fc]{background:none;border:none;color:#f2f2f7;cursor:pointer;border-radius:50%;display:flex;justify-content:center;align-items:center;transition:background-color 0.2s ease,transform 0.1s ease;font-size:15px;width:30px;height:30px}.control-btn[data-v-048593fc]:hover{background-color:rgba(255,255,255,0.1)}.control-btn[data-v-048593fc]:active{transform:scale(0.92);background-color:rgba(255,255,255,0.15)}.play-pause-btn[data-v-048593fc]{font-size:16px;width:36px;height:36px}.volume-control-wrapper[data-v-048593fc],.controls>.control-btn[data-v-048593fc]:first-child{width:30px}.volume-slider-container[data-v-048593fc]{position:absolute;bottom:40px;right:27px;transform:translateX(50%);animation:grow-up-048593fc 0.2s cubic-bezier(0.25,1,0.5,1);z-index:10;padding:10px 0;display:flex;justify-content:center}.custom-volume-slider[data-v-048593fc]{position:relative;width:24px;height:65px;cursor:pointer}.custom-volume-slider .track[data-v-048593fc]{position:absolute;top:0;left:50%;transform:translateX(-50%);width:6px;height:100%;background-color:#3a3a3c;border-radius:3px;overflow:hidden}.custom-volume-slider .progress[data-v-048593fc]{position:absolute;bottom:0;left:0;width:100%;background-color:#0a84ff;border-radius:3px}.custom-volume-slider .thumb[data-v-048593fc]{position:absolute;left:50%;transform:translateX(-50%);width:8px;height:8px;background-color:#ffffff;border-radius:50%;pointer-events:none;box-shadow:0 1px 3px rgba(0,0,0,0.3)}@keyframes grow-up-048593fc{from{opacity:0;transform:translateX(50%) scaleY(0.5);transform-origin:bottom}to{opacity:1;transform:translateX(50%) scaleY(1);transform-origin:bottom}}.playlist-drawer[data-v-048593fc]{flex-grow:1;overflow-y:auto;margin:4px -12px -12px;padding:4px 8px 12px 8px;scrollbar-width:thin;scrollbar-color:#8e8e93 #3a3a3c;transition:max-height 0.35s cubic-bezier(0.4,0,0.2,1),opacity 0.2s ease;max-height:0;opacity:0;visibility:hidden}.aria-pod-container.is-playlist-open .playlist-drawer[data-v-048593fc]{max-height:120px;opacity:1;visibility:visible}.playlist[data-v-048593fc]{list-style:none;padding:0;margin:0}.playlist li[data-v-048593fc]{display:grid;grid-template-columns:20px 1fr auto;gap:10px;align-items:center;padding:8px;border-radius:8px;cursor:pointer;font-size:14px;transition:background-color 0.2s;animation:fade-in-up-048593fc 0.3s ease-out both}.playlist li[data-v-048593fc]:nth-child(1){animation-delay:0.05s}.playlist li[data-v-048593fc]:nth-child(2){animation-delay:0.1s}.playlist li[data-v-048593fc]:nth-child(3){animation-delay:0.15s}.playlist li[data-v-048593fc]:nth-child(4){animation-delay:0.2s}.playlist li[data-v-048593fc]:nth-child(5){animation-delay:0.25s}@keyframes fade-in-up-048593fc{from{opacity:0;transform:translateY(10px)}to{opacity:1;transform:translateY(0)}}.playlist li[data-v-048593fc]:hover{background-color:rgba(255,255,255,0.1)}.playlist li.active[data-v-048593fc]{background-color:#0a84ff;color:white}.playlist li.active .artist[data-v-048593fc],.playlist li.active .index[data-v-048593fc]{color:rgba(255,255,255,0.8)}.playlist li .index[data-v-048593fc]{color:#8e8e93;text-align:right;font-size:12px}.playlist li .artist[data-v-048593fc]{color:#8e8e93;text-align:right;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}.error-overlay[data-v-048593fc]{position:absolute;top:0;left:0;right:0;bottom:0;display:flex;flex-direction:column;justify-content:center;align-items:center;text-align:center;padding:20px;background-color:rgba(255,59,48,0.2);border:1px solid rgba(255,59,48,0.5);border-radius:12px;z-index:20}.error-overlay p[data-v-048593fc]{margin:0 0 5px 0}.error-overlay small[data-v-048593fc]{margin:0}


/*# sourceMappingURL=main.css.map*/</style></head><body><div id="app"></div></body>